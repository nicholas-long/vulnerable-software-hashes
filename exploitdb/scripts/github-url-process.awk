#!/usr/bin/awk -f
BEGIN {
  FS = OFS = "\t"
}
$0 !~ /github\.com/ { next } # skip not github
{
  split($3, arr, "/")
  reponame = ""
  for (n = 0; n < length(arr); n++) {
    if (arr[n] == "github.com") {
      reponame = "https://github.com/" arr[n + 1] "/" arr[n + 2]
      break
    }
  }
}
/blob/ { # direct links to files on someone's github repo
  print $0, "FILE", reponame
  next
}
# ordinary case - just a normal link
$3 ~ /github\.com\/[A-Za-z0-9_\.-]+\/[A-Za-z0-9_\.-]+\/?$/ {
  repo = $3
  gsub(/\/$/,"")
  print $0, "REPO", reponame
  next
}
$3 ~ /\/releases\/?$/ {
  gsub(/\/releases\/?$/,"",$3)
  print $0, "REPO", reponame
  next
}
/releases\/tag/ {
  repo = $3
  tag = repo
  gsub(/^.*releases\/tag\//, "", tag)
  print $0, "REPO_TAG", reponame, tag
  next
}
{ print $0, "UNKNOWN", reponame }
