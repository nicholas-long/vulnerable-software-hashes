#!/bin/bash

awk '
BEGIN { FS = OFS = "\t" }
$1 ~ /^http:/ {
  url = $1
  if (!seen[url]) {
    newurl = url
    gsub(/^http:/,"https:",newurl)
    command = "timeout 10 curl -f \047" newurl "\047 2>/dev/null | file -"
    command | getline result
    close(command)
    gsub(/^.dev.stdin: /,"",result)
    print url, newurl, result
    seen[url] = 1
  }
}
' data/remaining-to-process.tsv
