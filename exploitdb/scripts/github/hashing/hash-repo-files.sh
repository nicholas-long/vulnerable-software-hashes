#!/bin/bash
SCRIPT_DIR=$( cd -- "$( dirname -- "${BASH_SOURCE[0]}" )" &> /dev/null && pwd )

repo="$1"
# clone repo into temp dir
tf=$(mktemp -d)
git clone --mirror https://github.com/$repo $tf
printf "repo\t%s\n" $repo
cd $tf

# get all tags and start walking their commits
awk -f $SCRIPT_DIR/hash-repo-files.awk packed-refs

cd - 2>/dev/null >/dev/null
rm -rf $tf
