#!/bin/bash

export url="$1"
reponame=$(awk 'BEGIN {FS=OFS="/"} { print $(NF-1),$NF }' <(echo $url))
repoindex=$(awk '$0 == ENVIRON["url"] { print NR }' github-urls-to-clone.lst)
outputfile="data/github-hashes/$repoindex.gz"
errorfile="data/github-hashes/$repoindex.err"
if [ -f "$outputfile" ]; then # exit to avoid redoing a repo
  exit 1
fi
scripts/github/hashing/hash-repo-files.sh $reponame 2> $errorfile | gzip > $outputfile
