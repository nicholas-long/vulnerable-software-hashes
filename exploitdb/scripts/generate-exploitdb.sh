#!/bin/bash

# get software list from exploitdb data by grepping for "Software Link" and similar comments
grep -R '^# .*Software' /usr/share/exploitdb/exploits/ | awk '
BEGIN {
  OFS = "\t"
}
$NF ~ /^[a-z]+:\/\// {
  f = $1
  url = $NF
  gsub(/:.*$/,"",f)
  gsub(/^.usr.share.exploitdb./,"",f)
  print f, url
}
' | sed \
  -e 's_https://https://_https://_' \
  -e 's_http://http://_http://_' \
  | awk '
    BEGIN { FS = OFS = "\t" }
    /http:...*<http:[^>]*>/ { # fix up multiple included URLs with <> tags
      file = $1
      fixed = $2
      included = $2
      gsub(/<http.*/,"",fixed)
      gsub(/^.*</,"",included)
      gsub(/>$/,"",included)
      print file, fixed
      print file, included
      next # skip default case
    }
    { print } # default case
  ' | awk '
    BEGIN { FS = OFS = "\t" }
    {
      f = $1
      gsub(/.*\//,"",f)
      gsub(/\..*$/,"",f)
      print f, $0
    }
  ' | awk '!unique[$0]++ { print }' | sort -n
