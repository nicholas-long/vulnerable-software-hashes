#!/bin/bash

scripts/exploitdb-process-file-list.sh > data/exploitdb-direct-links.tsv

scripts/generate-master-list.sh > master-url-list.tsv
scripts/usable-raw-urls.awk data/url-results.tsv > data/usable-raw-urls.tsv
scripts/remaining-urls.awk data/url-results.tsv > data/remaining-to-process.tsv
awk '
BEGIN { FS = OFS = "\t" }
ARGIND == 1 { urls[$1] = 1 }
ARGIND == 2 && $3 in urls { print }
' data/remaining-to-process.tsv data/exploitdb_links_raw.tsv > remaining.tsv

# gzip
#scripts/test-gzip.sh | paste - - > data/ungzip-results.tsv
# http to https
#scripts/http-urls-remaining.sh | tee data/http-to-https-results.tsv
#awk -f scripts/usable-raw-urls.awk data/http-to-https-results.tsv > data/usable-http-https-converted-urls.tsv
# https urls join with http to https conversions
#scripts/get-http-https-modifications.sh > data-entry-urls.tsv
# github
#scripts/github-url-process.awk remaining.tsv > data/github-urls.tsv
#awk -F $'\t' '$4 !~ /UNK/ {print $5}' data/github-urls.tsv | awk '!seen[$0]++ { print }' > github-urls-to-clone.lst
# exploitdb
#./request-exploitdb-files.sh > data/exploitdb_raw_data
# hash github
#awk '{print "scripts/github/hashing/hash-single-main.sh",$0}' github-urls-to-clone.lst | parallel
# clean up repos that failed due to low disk space in vm
#grep -R 'space left' | cut -d . -f 1 | awk '{system("rm " $0 ".*")}'
